<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nghe v√† Vi·∫øt Ch√≠nh T·∫£: My First Sentences</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --primary-color: #ec407a;
            --primary-dark: #c2185b;
            --success-color: #4caf50;
            --error-color: #f44336;
            --light-bg: #fce4ec;
            --text-color: #333;
            --white-color: #ffffff;
            --yellow-color: #ffc107;
            --topic-color-1: #ef5350;
            --topic-color-2: #42a5f5;
            --topic-color-3: #66bb6a;
            --topic-color-4: #ffa726;
            --topic-color-5: #ab47bc;
            --topic-color-6: #78909c;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(120deg, #f8bbd0 0%, #ce93d8 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--text-color);
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
        }

        #root {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            text-align: center;
            padding: 25px;
            max-width: 900px;
            width: 95%;
            background: var(--white-color);
            border-radius: 24px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1), 0 4px 15px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
        }

        .game-title {
            font-size: clamp(1.8em, 5vw, 2.5em);
            color: var(--primary-color);
            margin: 0 0 5px;
            font-weight: 700;
        }

        .game-subtitle {
            font-size: clamp(1.2em, 4vw, 1.5em);
            margin-bottom: 20px;
            color: #555;
            font-weight: 600;
        }

        .meaning {
            font-size: clamp(1.1em, 4.5vw, 1.6em);
            color: var(--primary-dark);
            margin: 15px 0;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .input-container {
            position: relative;
            margin: 30px 0;
        }

        #answerInput,
        .text-input {
            width: 100%;
            padding: 15px 20px;
            font-size: clamp(1.1em, 4vw, 1.6em);
            font-family: 'Nunito', sans-serif;
            border-radius: 12px;
            border: 3px solid var(--primary-color);
            box-sizing: border-box;
            text-align: center;
            transition: all 0.3s ease;
        }

        #answerInput:focus,
        .text-input:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(236, 64, 122, 0.3);
        }

        #answerInput.correct {
            border-color: var(--success-color);
            background-color: #e8f5e9;
        }

        #answerInput.incorrect {
            border-color: var(--error-color);
            animation: shake 0.5s;
        }

        #hint {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: clamp(1.1em, 4vw, 1.6em);
            font-weight: 600;
            pointer-events: none;
            z-index: 10;
            width: max-content;
            max-width: 90%;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        button {
            background: var(--primary-color);
            color: var(--white-color);
            border: none;
            padding: 12px 28px;
            border-radius: 12px;
            font-size: clamp(0.9em, 3.5vw, 1.1em);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover,
        button:focus {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            outline: none;
        }

        button:disabled {
            background: #bdbdbd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .score {
            font-size: clamp(1.1em, 4vw, 1.4em);
            margin-top: 20px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .message {
            font-size: clamp(1.1em, 4vw, 1.4em);
            margin: 15px 0;
            font-weight: 700;
            min-height: 25px;
            color: var(--error-color);
        }

        .start-screen,
        .topic-selection-screen,
        .topic-congrats-screen,
        .review-errors-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        .main-btn,
        .topic-btn,
        .congrats-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 16px;
            width: 90%;
            max-width: 450px;
        }
        
        .topic-btn-container {
             display: flex;
             flex-direction: column;
             width: 100%;
             align-items: center;
             gap: 15px;
        }

        .main-btn { background-color: var(--success-color); }
        .main-btn:hover { background: #388e3c; }
        
        .topic-btn-color-1 { background-color: var(--topic-color-1); }
        .topic-btn-color-1:hover { background-color: #d32f2f; }
        .topic-btn-color-2 { background-color: var(--topic-color-2); }
        .topic-btn-color-2:hover { background-color: #1976d2; }
        .topic-btn-color-3 { background-color: var(--topic-color-3); }
        .topic-btn-color-3:hover { background-color: #388e3c; }
        .topic-btn-color-4 { background-color: var(--topic-color-4); }
        .topic-btn-color-4:hover { background-color: #f57c00; }
        .topic-btn-color-5 { background-color: var(--topic-color-5); }
        .topic-btn-color-5:hover { background-color: #8e24aa; }
        .topic-btn-color-6 { background-color: var(--topic-color-6); }
        .topic-btn-color-6:hover { background-color: #546e7a; }

        #playerNameInput {
            font-family: 'Nunito', sans-serif;
            font-size: 1.2em;
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid var(--primary-color);
            text-align: center;
            width: 80%;
            max-width: 300px;
        }

        .error-review-list {
            list-style-type: none;
            padding: 0;
            width: 100%;
            max-height: 40vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .error-review-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        .error-review-item:last-child {
            border-bottom: none;
        }
        .error-label {
            font-weight: 700;
            font-size: 0.9em;
        }
        .correct-answer {
            color: var(--success-color);
            word-break: break-all;
        }
        .user-answer {
            color: var(--error-color);
            word-break: break-all;
        }
        .error-char {
            color: #d32f2f;
            font-weight: bold;
            text-decoration: underline;
            background-color: #ffebee;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            button { padding: 10px 20px; }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const allSentences = [
            { en: "I don't like rainy days.", vi: "T√¥i kh√¥ng th√≠ch nh·ªØng ng√†y m∆∞a.", emoji: "üåßÔ∏è" },
            { en: "My uncle raises a lot of cows and buffaloes.", vi: "Ch√∫ t√¥i nu√¥i r·∫•t nhi·ªÅu b√≤ v√† tr√¢u.", emoji: "üêÉ" },
            { en: "I think her daughter is lovely.", vi: "T√¥i nghƒ© con g√°i c√¥ ·∫•y th·∫≠t ƒë√°ng y√™u.", emoji: "üëß" },
            { en: "I like cheese very much.", vi: "T√¥i r·∫•t th√≠ch ph√¥ mai.", emoji: "üßÄ" },
            { en: "Everybody likes Bao, because he is friendly and sociable.", vi: "M·ªçi ng∆∞·ªùi ƒë·ªÅu th√≠ch B·∫£o, v√¨ c·∫≠u ·∫•y th√¢n thi·ªán v√† h√≤a ƒë·ªìng.", emoji: "üòä" },
            { en: "\"Glee\" is my favourite musical TV series.", vi: "\"Glee\" l√† b·ªô phim truy·ªÅn h√¨nh ca nh·∫°c y√™u th√≠ch c·ªßa t√¥i.", emoji: "üì∫" },
            { en: "She didn't do any homework. She was too lazy.", vi: "C√¥ ·∫•y ƒë√£ kh√¥ng l√†m b√†i t·∫≠p v·ªÅ nh√†. C√¥ ·∫•y qu√° l∆∞·ªùi bi·∫øng.", emoji: "üìö" },
            { en: "What is your teacher like? ‚Äì He is a very tall man.", vi: "Gi√°o vi√™n c·ªßa b·∫°n tr√¥ng nh∆∞ th·∫ø n√†o? - Th·∫ßy ·∫•y l√† m·ªôt ng∆∞·ªùi ƒë√†n √¥ng r·∫•t cao.", emoji: "üë®‚Äçüè´" },
            { en: "I usually do my homework at night.", vi: "T√¥i th∆∞·ªùng l√†m b√†i t·∫≠p v·ªÅ nh√† v√†o bu·ªïi t·ªëi.", emoji: "üåô" },
            { en: "Give me some ice water, will you?", vi: "Cho t√¥i m·ªôt √≠t n∆∞·ªõc ƒë√° nh√©?", emoji: "üíß" },
            { en: "I always brush my teeth after every meal.", vi: "T√¥i lu√¥n ƒë√°nh rƒÉng sau m·ªói b·ªØa ƒÉn.", emoji: "ü¶∑" },
            { en: "In the future, we will have less work and more money to spend.", vi: "Trong t∆∞∆°ng lai, ch√∫ng ta s·∫Ω c√≥ √≠t vi·ªác h∆°n v√† nhi·ªÅu ti·ªÅn h∆°n ƒë·ªÉ ti√™u.", emoji: "üí∞" },
            { en: "How old are you? I am 10 years old.", vi: "B·∫°n bao nhi√™u tu·ªïi? T√¥i 10 tu·ªïi.", emoji: "üîü" },
            { en: "How was your last trip to England?", vi: "Chuy·∫øn ƒëi cu·ªëi c√πng c·ªßa b·∫°n ƒë·∫øn Anh th·∫ø n√†o?", emoji: "üá¨üáß" },
            { en: "When won't she phone her? on weekends.", vi: "Khi n√†o c√¥ ·∫•y s·∫Ω kh√¥ng g·ªçi cho c√¥ ·∫•y? v√†o cu·ªëi tu·∫ßn.", emoji: "üìû" },
            { en: "He got up very early and ran downstairs to the kitchen.", vi: "Anh ·∫•y d·∫≠y r·∫•t s·ªõm v√† ch·∫°y xu·ªëng b·∫øp.", emoji: "üèÉ" },
            { en: "When was her cousin born? two months ago.", vi: "Anh h·ªç c·ªßa c√¥ ·∫•y sinh khi n√†o? hai th√°ng tr∆∞·ªõc.", emoji: "üë∂" },
            { en: "We are listening to our teacher.", vi: "Ch√∫ng t√¥i ƒëang l·∫Øng nghe gi√°o vi√™n c·ªßa ch√∫ng t√¥i.", emoji: "üë®‚Äçüè´" },
            { en: "Children must be careful when they cross the road.", vi: "Tr·∫ª em ph·∫£i c·∫©n th·∫≠n khi qua ƒë∆∞·ªùng.", emoji: "üö∏" },
            { en: "There's a concert at the theatre on Sunday.", vi: "C√≥ m·ªôt bu·ªïi h√≤a nh·∫°c t·∫°i nh√† h√°t v√†o Ch·ªß nh·∫≠t.", emoji: "üéµ" },
            { en: "We're going to see a movie. How about you?", vi: "Ch√∫ng t√¥i s·∫Ω ƒëi xem phim. C√≤n b·∫°n th√¨ sao?", emoji: "üé¨" },
            { en: "The boys spent all days travelling by bus around Hanoi.", vi: "C√°c c·∫≠u b√© ƒë√£ d√†nh c·∫£ ng√†y ƒëi du l·ªãch b·∫±ng xe bu√Ωt quanh H√† N·ªôi.", emoji: "üöå" },
            { en: "Mother told me not to spend too much time on playing games.", vi: "M·∫π d·∫∑n t√¥i kh√¥ng ƒë∆∞·ª£c d√†nh qu√° nhi·ªÅu th·ªùi gian ƒë·ªÉ ch∆°i game.", emoji: "üéÆ" },
            { en: "Laura didn't want to buy a new television.", vi: "Laura kh√¥ng mu·ªën mua m·ªôt chi·∫øc tivi m·ªõi.", emoji: "üì∫" },
            { en: "Where is the museum? next to the hospital.", vi: "B·∫£o t√†ng ·ªü ƒë√¢u? c·∫°nh b·ªánh vi·ªán.", emoji: "üè•" },
            { en: "How far is it from your house to the stadium? About 7 kilometers.", vi: "T·ª´ nh√† b·∫°n ƒë·∫øn s√¢n v·∫≠n ƒë·ªông bao xa? Kho·∫£ng 7 c√¢y s·ªë.", emoji: "üèüÔ∏è" },
            { en: "Minh's father works in the factory.", vi: "B·ªë c·ªßa Minh l√†m vi·ªác trong nh√† m√°y.", emoji: "üè≠" },
            { en: "What is there for breakfast? Bread and milk.", vi: "C√≥ g√¨ cho b·ªØa s√°ng? B√°nh m√¨ v√† s·ªØa.", emoji: "üçû" },
            { en: "I want to go camping this Sunday.", vi: "T√¥i mu·ªën ƒëi c·∫Øm tr·∫°i v√†o Ch·ªß nh·∫≠t n√†y.", emoji: "üèïÔ∏è" },
            { en: "Everyone of us can play a sport, or a game or watch sports events on TV or at the stadium.", vi: "M·ªói ng∆∞·ªùi trong ch√∫ng ta ƒë·ªÅu c√≥ th·ªÉ ch∆°i m·ªôt m√¥n th·ªÉ thao, m·ªôt tr√≤ ch∆°i ho·∫∑c xem c√°c s·ª± ki·ªán th·ªÉ thao tr√™n TV ho·∫∑c t·∫°i s√¢n v·∫≠n ƒë·ªông.", emoji: "üèüÔ∏è" },
            { en: "We eat in a big restaurant.", vi: "Ch√∫ng t√¥i ƒÉn ·ªü m·ªôt nh√† h√†ng l·ªõn.", emoji: "üçΩÔ∏è" },
            { en: "Lan and Hoa sometimes go to the zoo.", vi: "Lan v√† Hoa th·ªânh tho·∫£ng ƒëi s·ªü th√∫.", emoji: "üêí" },
            { en: "Hoa is filling in her medical report.", vi: "Hoa ƒëang ƒëi·ªÅn v√†o b√°o c√°o y t·∫ø c·ªßa m√¨nh.", emoji: "üìù" },
            { en: "He is going to take some photos.", vi: "Anh ·∫•y s·∫Ω ch·ª•p m·ªôt v√†i b·ª©c ·∫£nh.", emoji: "üì∏" },
            { en: "Was your old school big? No, it isn't.", vi: "Tr∆∞·ªùng c≈© c·ªßa b·∫°n c√≥ l·ªõn kh√¥ng? Kh√¥ng, kh√¥ng l·ªõn.", emoji: "üè´" },
            { en: "She has to learn how to cook some new dishes.", vi: "C√¥ ·∫•y ph·∫£i h·ªçc c√°ch n·∫•u m·ªôt s·ªë m√≥n ƒÉn m·ªõi.", emoji: "üç≥" },
            { en: "Do they have any beans? No, they don't.", vi: "H·ªç c√≥ h·∫°t ƒë·∫≠u n√†o kh√¥ng? Kh√¥ng, h·ªç kh√¥ng c√≥.", emoji: "üå±" },
            { en: "He rides his bike home and has lunch at 12.", vi: "Anh ·∫•y ƒë·∫°p xe v·ªÅ nh√† v√† ƒÉn tr∆∞a l√∫c 12 gi·ªù.", emoji: "üö≤" },
            { en: "Tuan goes fishing twice a week.", vi: "Tu·∫•n ƒëi c√¢u c√° hai l·∫ßn m·ªôt tu·∫ßn.", emoji: "üé£" },
            { en: "I bought a cup of coffee and some pizzas for my lunch.", vi: "T√¥i ƒë√£ mua m·ªôt t√°ch c√† ph√™ v√† m·ªôt v√†i chi·∫øc pizza cho b·ªØa tr∆∞a c·ªßa m√¨nh.", emoji: "üçï" },
            { en: "Breakfast is the meal we have in the morning.", vi: "B·ªØa s√°ng l√† b·ªØa ƒÉn ch√∫ng ta c√≥ v√†o bu·ªïi s√°ng.", emoji: "üåÖ" },
            { en: "This is the longest river in the world.", vi: "ƒê√¢y l√† con s√¥ng d√†i nh·∫•t th·∫ø gi·ªõi.", emoji: "üèûÔ∏è" },
            { en: "Can I help you? Yes, I'd like some beef, please.", vi: "T√¥i c√≥ th·ªÉ gi√∫p b·∫°n kh√¥ng? V√¢ng, l√†m ∆°n cho t√¥i m·ªôt √≠t th·ªãt b√≤.", emoji: "ü•©" },
            { en: "She thinks that playing the piano is very interesting.", vi: "C√¥ ·∫•y nghƒ© r·∫±ng ch∆°i piano r·∫•t th√∫ v·ªã.", emoji: "üéπ" },
            { en: "Hoi An is a historical city with a lot of old houses, shops and buildings.", vi: "H·ªôi An l√† m·ªôt th√†nh ph·ªë l·ªãch s·ª≠ v·ªõi r·∫•t nhi·ªÅu ng√¥i nh√† c·ªï, c·ª≠a h√†ng v√† t√≤a nh√†.", emoji: "üèòÔ∏è" },
            { en: "Plants live in soil and they find water there.", vi: "Th·ª±c v·∫≠t s·ªëng trong ƒë·∫•t v√† ch√∫ng t√¨m th·∫•y n∆∞·ªõc ·ªü ƒë√≥.", emoji: "üíß" },
            { en: "Long Bien Bridge was the longest one in Vietnam in the early 20th century.", vi: "C·∫ßu Long Bi√™n l√† c√¢y c·∫ßu d√†i nh·∫•t Vi·ªát Nam v√†o ƒë·∫ßu th·∫ø k·ª∑ 20.", emoji: "üåâ" },
            { en: "Can you see any people in the house? Only a few.", vi: "B·∫°n c√≥ th·∫•y ai trong nh√† kh√¥ng? Ch·ªâ m·ªôt v√†i ng∆∞·ªùi.", emoji: "üë®‚Äçüë©‚Äçüëß" },
            { en: "Yesterday was Sunday and I got up very late.", vi: "H√¥m qua l√† Ch·ªß nh·∫≠t v√† t√¥i ƒë√£ d·∫≠y r·∫•t mu·ªôn.", emoji: "‚è∞" },
            { en: "How much do these eggs cost?", vi: "Nh·ªØng qu·∫£ tr·ª©ng n√†y gi√° bao nhi√™u?", emoji: "ü•ö" },
            { en: "Summer is on its way.", vi: "M√πa h√® ƒëang ƒë·∫øn.", emoji: "‚òÄÔ∏è" },
            { en: "My grandmother often tells me some fairy stories in the evening.", vi: "B√† t√¥i th∆∞·ªùng k·ªÉ cho t√¥i nghe m·ªôt v√†i c√¢u chuy·ªán c·ªï t√≠ch v√†o bu·ªïi t·ªëi.", emoji: "üëµ" },
            { en: "She sends flowers to her friend.", vi: "C√¥ ·∫•y g·ª≠i hoa cho b·∫°n m√¨nh.", emoji: "üíê" },
            { en: "You are very different from your brother.", vi: "B·∫°n r·∫•t kh√°c v·ªõi anh trai c·ªßa b·∫°n.", emoji: "üßë‚Äçü§ù‚Äçüßë" },
            { en: "There is much milk in the glass.", vi: "C√≥ r·∫•t nhi·ªÅu s·ªØa trong ly.", emoji: "ü•õ" },
            { en: "In the story, there was a princess living in the castle.", vi: "Trong c√¢u chuy·ªán, c√≥ m·ªôt n√†ng c√¥ng ch√∫a s·ªëng trong l√¢u ƒë√†i.", emoji: "üè∞" },
            { en: "The boy in the corner is my friend.", vi: "C·∫≠u b√© ·ªü g√≥c l√† b·∫°n c·ªßa t√¥i.", emoji: "üë¶" },
            { en: "Do you feel hot? No, I feel cold.", vi: "B·∫°n c√≥ c·∫£m th·∫•y n√≥ng kh√¥ng? Kh√¥ng, t√¥i c·∫£m th·∫•y l·∫°nh.", emoji: "ü•∂" },
            { en: "His sister is out when he calls.", vi: "Ch·ªã g√°i anh ·∫•y ra ngo√†i khi anh ·∫•y g·ªçi.", emoji: "üì±" },
            { en: "is a scarf with red and blue stripes on the snowman.", vi: "l√† m·ªôt chi·∫øc khƒÉn qu√†ng c·ªï c√≥ s·ªçc ƒë·ªè v√† xanh tr√™n ng∆∞·ªùi tuy·∫øt.", emoji: "‚òÉÔ∏è" },
            { en: "Oh, no! It is raining. What a pity!", vi: "√îi, kh√¥ng! Tr·ªùi ƒëang m∆∞a. Th·∫≠t ƒë√°ng ti·∫øc!", emoji: "üåßÔ∏è" },
            { en: "They are working on the farm.", vi: "H·ªç ƒëang l√†m vi·ªác tr√™n n√¥ng tr·∫°i.", emoji: "üöú" },
            { en: "She doesn't like coffee, does she? - No, she doesn't.", vi: "C√¥ ·∫•y kh√¥ng th√≠ch c√† ph√™, ph·∫£i kh√¥ng? - Kh√¥ng, c√¥ ·∫•y kh√¥ng th√≠ch.", emoji: "‚òï" },
            { en: "I was 23 years old in 1999.", vi: "T√¥i 23 tu·ªïi v√†o nƒÉm 1999.", emoji: "üìÖ" },
            { en: "The earthquake happened about 3000 years ago on Santorini.", vi: "Tr·∫≠n ƒë·ªông ƒë·∫•t x·∫£y ra kho·∫£ng 3000 nƒÉm tr∆∞·ªõc ·ªü Santorini.", emoji: "üåã" },
            { en: "How much is an ice-cream? It's 1,000 dong.", vi: "M·ªôt c√¢y kem gi√° bao nhi√™u? 1.000 ƒë·ªìng.", emoji: "üç¶" },
            { en: "Minh is unhappy because he doesn't have any friends here.", vi: "Minh kh√¥ng vui v√¨ anh ·∫•y kh√¥ng c√≥ b·∫°n b√® ·ªü ƒë√¢y.", emoji: "üòî" },
            { en: "Last Wednesday, Bill rang his office at nine o'clock.", vi: "Th·ª© T∆∞ tu·∫ßn tr∆∞·ªõc, Bill ƒë√£ g·ªçi ƒë·∫øn vƒÉn ph√≤ng c·ªßa m√¨nh l√∫c ch√≠n gi·ªù.", emoji: "üìû" },
            { en: "When did James return to his hometown from London?", vi: "James tr·ªü v·ªÅ qu√™ h∆∞∆°ng t·ª´ London khi n√†o?", emoji: "üá¨üáß" },
            { en: "My house is near a market so it's very noisy.", vi: "Nh√† t√¥i g·∫ßn ch·ª£ n√™n r·∫•t ·ªìn √†o.", emoji: " ‡§¨‡§æ‡§ú‡§æ‡§∞" },
            { en: "My family often has lunch at 12:00.", vi: "Gia ƒë√¨nh t√¥i th∆∞·ªùng ƒÉn tr∆∞a l√∫c 12:00.", emoji: "üïõ" },
            { en: "David and Mary brush their teeth every evening.", vi: "David v√† Mary ƒë√°nh rƒÉng m·ªói t·ªëi.", emoji: "ü¶∑" },
            { en: "Do you have any bananas?", vi: "B·∫°n c√≥ qu·∫£ chu·ªëi n√†o kh√¥ng?", emoji: "üçå" },
            { en: "My house was built in 1998.", vi: "Nh√† t√¥i ƒë∆∞·ª£c x√¢y d·ª±ng v√†o nƒÉm 1998.", emoji: "üè†" },
            { en: "What time does he go to school? - He goes to school at 7 o'clock.", vi: "Anh ·∫•y ƒëi h·ªçc l√∫c m·∫•y gi·ªù? - Anh ·∫•y ƒëi h·ªçc l√∫c 7 gi·ªù.", emoji: "üïñ" },
            { en: "A person who watches and protects children at the pool is a life guard.", vi: "M·ªôt ng∆∞·ªùi tr√¥ng coi v√† b·∫£o v·ªá tr·∫ª em t·∫°i h·ªì b∆°i l√† m·ªôt nh√¢n vi√™n c·ª©u h·ªô.", emoji: "üèä" },
            { en: "What company does Steve work for? publishing.", vi: "Steve l√†m vi·ªác cho c√¥ng ty n√†o? xu·∫•t b·∫£n.", emoji: "üè¢" },
            { en: "Have you finished your homework yet?", vi: "B·∫°n ƒë√£ l√†m xong b√†i t·∫≠p v·ªÅ nh√† ch∆∞a?", emoji: "üìù" },
            { en: "Is Nick with his brother and sister?", vi: "Nick c√≥ ·ªü c√πng v·ªõi anh trai v√† ch·ªã g√°i c·ªßa m√¨nh kh√¥ng?", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { en: "How much is this shirt?", vi: "C√°i √°o n√†y gi√° bao nhi√™u?", emoji: "üëï" },
            { en: "Where does Ba often go in the morning?", vi: "Ba th∆∞·ªùng ƒëi ƒë√¢u v√†o bu·ªïi s√°ng?", emoji: "üåÖ" },
            { en: "Did you eat noodles for breakfast yesterday?", vi: "H√¥m qua b·∫°n c√≥ ƒÉn m√¨ cho b·ªØa s√°ng kh√¥ng?", emoji: "üçú" },
            { en: "Anna spend most of her time studying in the library.", vi: "Anna d√†nh ph·∫ßn l·ªõn th·ªùi gian h·ªçc ·ªü th∆∞ vi·ªán.", emoji: "üìö" },
            { en: "People come from all over the world to visit the city of Hiroshima.", vi: "M·ªçi ng∆∞·ªùi t·ª´ kh·∫Øp n∆°i tr√™n th·∫ø gi·ªõi ƒë·∫øn thƒÉm th√†nh ph·ªë Hiroshima.", emoji: "üåç" },
            { en: "How much do these flowers cost?", vi: "Nh·ªØng b√¥ng hoa n√†y gi√° bao nhi√™u?", emoji: "üíê" },
            { en: "I always wish for a long and happy life for my parents.", vi: "T√¥i lu√¥n mong mu·ªën m·ªôt cu·ªôc s·ªëng l√¢u d√†i v√† h·∫°nh ph√∫c cho cha m·∫π t√¥i.", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { en: "Thank you for helping me with my housework.", vi: "C·∫£m ∆°n b·∫°n ƒë√£ gi√∫p t√¥i vi·ªác nh√†.", emoji: "üôè" },
            { en: "They have to wear uniforms on Mondays.", vi: "H·ªç ph·∫£i m·∫∑c ƒë·ªìng ph·ª•c v√†o c√°c ng√†y th·ª© Hai.", emoji: "üëî" },
            { en: "Many people say that Japanese is the most difficult language in the world.", vi: "Nhi·ªÅu ng∆∞·ªùi n√≥i r·∫±ng ti·∫øng Nh·∫≠t l√† ng√¥n ng·ªØ kh√≥ nh·∫•t tr√™n th·∫ø gi·ªõi.", emoji: "üáØüáµ" },
            { en: "I don't have much time to read books.", vi: "T√¥i kh√¥ng c√≥ nhi·ªÅu th·ªùi gian ƒë·ªÉ ƒë·ªçc s√°ch.", emoji: "üìö" },
            { en: "It's the twentieth of February.", vi: "H√¥m nay l√† ng√†y 20 th√°ng 2.", emoji: "üìÖ" },
            { en: "I have lived in Ho Chi Minh City for 10 years.", vi: "T√¥i ƒë√£ s·ªëng ·ªü Th√†nh ph·ªë H·ªì Ch√≠ Minh ƒë∆∞·ª£c 10 nƒÉm.", emoji: "üáªüá≥" },
            { en: "What a lovely room you have!", vi: "B·∫°n c√≥ m·ªôt cƒÉn ph√≤ng th·∫≠t ƒë√°ng y√™u!", emoji: "üè†" },
            { en: "It was very long and thin and it looks like a snake.", vi: "N√≥ r·∫•t d√†i v√† m·ªèng v√† tr√¥ng gi·ªëng nh∆∞ m·ªôt con r·∫Øn.", emoji: "üêç" },
            { en: "It's always hot in summer in Hanoi.", vi: "M√πa h√® ·ªü H√† N·ªôi lu√¥n n√≥ng.", emoji: "‚òÄÔ∏è" },
            { en: "I phoned her five times last night, but she didn't answer.", vi: "T·ªëi qua t√¥i ƒë√£ g·ªçi cho c√¥ ·∫•y nƒÉm l·∫ßn, nh∆∞ng c√¥ ·∫•y kh√¥ng tr·∫£ l·ªùi.", emoji: "üìû" },
            { en: "The bag is behind the door.", vi: "C√°i t√∫i ·ªü sau c√°nh c·ª≠a.", emoji: "üö™" },
            { en: "We need five students to join this game.", vi: "Ch√∫ng t√¥i c·∫ßn nƒÉm sinh vi√™n ƒë·ªÉ tham gia tr√≤ ch∆°i n√†y.", emoji: "üéÆ" },
            { en: "She takes a bath every morning.", vi: "C√¥ ·∫•y t·∫Øm m·ªói s√°ng.", emoji: "üõÄ" },
            { en: "Go home now. It's late.", vi: "V·ªÅ nh√† ngay ƒëi. Mu·ªôn r·ªìi.", emoji: "‚è∞" },
            { en: "Our team will become famous for being good at football.", vi: "ƒê·ªôi c·ªßa ch√∫ng t√¥i s·∫Ω tr·ªü n√™n n·ªïi ti·∫øng v√¨ ch∆°i b√≥ng ƒë√° gi·ªèi.", emoji: "‚öΩ" },
            { en: "Is your hair black or brown? It's brown.", vi: "T√≥c b·∫°n m√†u ƒëen hay n√¢u? N√≥ m√†u n√¢u.", emoji: "üë±" },
            { en: "I have some bread and milk for breakfast.", vi: "T√¥i c√≥ m·ªôt √≠t b√°nh m√¨ v√† s·ªØa cho b·ªØa s√°ng.", emoji: "üçû" },
            { en: "My grandparents live on a farm.", vi: "√îng b√† t√¥i s·ªëng ·ªü m·ªôt trang tr·∫°i.", emoji: "üöú" },
            { en: "Do you feel nervous?", vi: "B·∫°n c√≥ c·∫£m th·∫•y lo l·∫Øng kh√¥ng?", emoji: "üòü" },
            { en: "Cinderella lost a shoe when running away from the ball.", vi: "C√¥ b√© L·ªç Lem ƒë√£ ƒë√°nh r∆°i m·ªôt chi·∫øc gi√†y khi ch·∫°y tr·ªën kh·ªèi v≈© h·ªôi.", emoji: "üë†" },
            { en: "We will go to the beach next weekend.", vi: "Ch√∫ng t√¥i s·∫Ω ƒëi bi·ªÉn v√†o cu·ªëi tu·∫ßn t·ªõi.", emoji: "üèñÔ∏è" },
            { en: "The Imperial Academy, or Quoc Tu Giam, is the first university in Vietnam.", vi: "Qu·ªëc T·ª≠ Gi√°m l√† tr∆∞·ªùng ƒë·∫°i h·ªçc ƒë·∫ßu ti√™n ·ªü Vi·ªát Nam.", emoji: "üéì" },
            { en: "What do you have for lunch?", vi: "B·∫°n c√≥ g√¨ cho b·ªØa tr∆∞a?", emoji: "üç±" },
            { en: "She decided to participate in her school's public speaking contest.", vi: "C√¥ quy·∫øt ƒë·ªãnh tham gia cu·ªôc thi h√πng bi·ªán c·ªßa tr∆∞·ªùng.", emoji: "üé§" },
            { en: "Let's go to the beach for our holiday.", vi: "Ch√∫ng ta h√£y ƒëi bi·ªÉn trong k·ª≥ ngh·ªâ c·ªßa ch√∫ng ta.", emoji: "üèñÔ∏è" },
            { en: "There are 4 people in my family.", vi: "Gia ƒë√¨nh t√¥i c√≥ 4 ng∆∞·ªùi.", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { en: "It takes me an hour to get to the village.", vi: "T√¥i m·∫•t m·ªôt gi·ªù ƒë·ªÉ ƒë·∫øn l√†ng.", emoji: "üè°" },
            { en: "I often leave home at 7 and drive my car to office.", vi: "T√¥i th∆∞·ªùng r·ªùi nh√† l√∫c 7 gi·ªù v√† l√°i xe ƒë·∫øn vƒÉn ph√≤ng.", emoji: "üöó" },
            { en: "We go to the market to do some shopping.", vi: "Ch√∫ng t√¥i ƒëi ch·ª£ ƒë·ªÉ mua s·∫Øm.", emoji: "üõí" },
            { en: "She is good at playing the guitar.", vi: "C√¥ ·∫•y gi·ªèi ch∆°i guitar.", emoji: "üé∏" },
            { en: "It's chewing gum. Chew it. Don't swallow it.", vi: "ƒê√≥ l√† k·∫πo cao su. Nhai n√≥ ƒëi. ƒê·ª´ng nu·ªët n√≥.", emoji: "üç¨" },
            { en: "People in Britain enjoy watching important football matches on TV.", vi: "Ng∆∞·ªùi d√¢n ·ªü Anh th√≠ch xem c√°c tr·∫≠n b√≥ng ƒë√° quan tr·ªçng tr√™n TV.", emoji: "‚öΩ" },
            { en: "There are two new stadiums in town.", vi: "C√≥ hai s√¢n v·∫≠n ƒë·ªông m·ªõi trong th·ªã tr·∫•n.", emoji: "üèüÔ∏è" },
            { en: "The Milers' goats produce lots of milk.", vi: "D√™ c·ªßa nh√† Milers cho r·∫•t nhi·ªÅu s·ªØa.", emoji: "üêê" },
            { en: "We collect waste food and feed it to pigs.", vi: "Ch√∫ng t√¥i thu gom th·ª©c ƒÉn th·ª´a v√† cho l·ª£n ƒÉn.", emoji: "üêñ" },
            { en: "Four seasons in a year are spring, summer, autumn and winter.", vi: "B·ªën m√πa trong m·ªôt nƒÉm l√† xu√¢n, h·∫°, thu v√† ƒë√¥ng.", emoji: "üçÇ" },
            { en: "Are there pink pens on the box?", vi: "C√≥ b√∫t m√†u h·ªìng tr√™n h·ªôp kh√¥ng?", emoji: "üñäÔ∏è" },
            { en: "Can I speak to Mike, please?", vi: "T√¥i c√≥ th·ªÉ n√≥i chuy·ªán v·ªõi Mike ƒë∆∞·ª£c kh√¥ng?", emoji: "üìû" },
            { en: "You can go boating on the West Lake.", vi: "B·∫°n c√≥ th·ªÉ ƒëi thuy·ªÅn tr√™n H·ªì T√¢y.", emoji: "üö£" },
            { en: "The weather is much better today than yesterday.", vi: "Th·ªùi ti·∫øt h√¥m nay t·ªët h∆°n nhi·ªÅu so v·ªõi h√¥m qua.", emoji: "‚òÄÔ∏è" },
            { en: "Pink is my favorite color.", vi: "M√†u h·ªìng l√† m√†u y√™u th√≠ch c·ªßa t√¥i.", emoji: "üé®" },
            { en: "Did your team win the match yesterday?", vi: "H√¥m qua ƒë·ªôi c·ªßa b·∫°n c√≥ th·∫Øng tr·∫≠n kh√¥ng?", emoji: "üèÜ" },
            { en: "Do you think it is boring to watch documentaries?", vi: "B·∫°n c√≥ nghƒ© xem phim t√†i li·ªáu l√† nh√†m ch√°n kh√¥ng?", emoji: "üé¨" },
            { en: "Does she like going out and enjoying herself?", vi: "C√¥ ·∫•y c√≥ th√≠ch ƒëi ch∆°i v√† t·∫≠n h∆∞·ªüng kh√¥ng?", emoji: "üíÉ" },
            { en: "The question sounds very easy.", vi: "C√¢u h·ªèi nghe c√≥ v·∫ª r·∫•t d·ªÖ.", emoji: "‚ùì" },
            { en: "Lan often does the housework after dinner.", vi: "Lan th∆∞·ªùng l√†m vi·ªác nh√† sau b·ªØa t·ªëi.", emoji: "üßπ" },
            { en: "Edward loves going on holiday with his family.", vi: "Edward th√≠ch ƒëi ngh·ªâ c√πng gia ƒë√¨nh.", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { en: "Would you like me to do that for you?", vi: "B·∫°n c√≥ mu·ªën t√¥i l√†m ƒëi·ªÅu ƒë√≥ cho b·∫°n kh√¥ng?", emoji: "ü§ù" },
            { en: "The wolf ran fast to get there and swallowed up the grandma.", vi: "Con s√≥i ch·∫°y nhanh ƒë·∫øn ƒë√≥ v√† nu·ªët ch·ª≠ng b√† gi√†.", emoji: "üê∫" },
            { en: "A weight lifter must be very strong.", vi: "M·ªôt v·∫≠n ƒë·ªông vi√™n c·ª≠ t·∫° ph·∫£i r·∫•t kh·ªèe.", emoji: "üèãÔ∏è" },
            { en: "Would you mind turning on the light?", vi: "B·∫°n c√≥ phi·ªÅn b·∫≠t ƒë√®n l√™n kh√¥ng?", emoji: "üí°" },
            { en: "Let him do it himself.", vi: "H√£y ƒë·ªÉ anh ·∫•y t·ª± l√†m.", emoji: "üßë" },
            { en: "He talks a lot about his new car.", vi: "Anh ·∫•y n√≥i r·∫•t nhi·ªÅu v·ªÅ chi·∫øc xe m·ªõi c·ªßa m√¨nh.", emoji: "üöó" },
            { en: "If we use less paper, we will save a lot of trees.", vi: "N·∫øu ch√∫ng ta s·ª≠ d·ª•ng √≠t gi·∫•y h∆°n, ch√∫ng ta s·∫Ω c·ª©u ƒë∆∞·ª£c r·∫•t nhi·ªÅu c√¢y.", emoji: "üå≥" },
            { en: "Please keep off the grass. You shouldn't walk on it.", vi: "Vui l√≤ng kh√¥ng ƒëi tr√™n c·ªè. B·∫°n kh√¥ng n√™n ƒëi tr√™n ƒë√≥.", emoji: "üö´" },
            { en: "This is our new English classmate.", vi: "ƒê√¢y l√† b·∫°n c√πng l·ªõp m·ªõi m√¥n ti·∫øng Anh c·ªßa ch√∫ng t√¥i.", emoji: "üßë‚Äçüéì" },
            { en: "The meal we have in the evening is called dinner.", vi: "B·ªØa ƒÉn ch√∫ng ta c√≥ v√†o bu·ªïi t·ªëi ƒë∆∞·ª£c g·ªçi l√† b·ªØa t·ªëi.", emoji: "üåÉ" },
            { en: "My sister doesn't like volleyball at all. She never plays it.", vi: "Ch·ªã t√¥i kh√¥ng th√≠ch b√≥ng chuy·ªÅn ch√∫t n√†o. Ch·ªã ·∫•y kh√¥ng bao gi·ªù ch∆°i n√≥.", emoji: "üèê" },
            { en: "My favorite football team will win all the matches this season.", vi: "ƒê·ªôi b√≥ng y√™u th√≠ch c·ªßa t√¥i s·∫Ω th·∫Øng t·∫•t c·∫£ c√°c tr·∫≠n ƒë·∫•u trong m√πa gi·∫£i n√†y.", emoji: "‚öΩ" },
            { en: "Some little cats are playing with my pillow.", vi: "M·ªôt v√†i ch√∫ m√®o con ƒëang ch∆°i v·ªõi chi·∫øc g·ªëi c·ªßa t√¥i.", emoji: "üê±" },
            { en: "Mr. Minh teaches English from 7:30 am to 9:00 pm every day.", vi: "Th·∫ßy Minh d·∫°y ti·∫øng Anh t·ª´ 7:30 s√°ng ƒë·∫øn 9:00 t·ªëi h√†ng ng√†y.", emoji: "üë®‚Äçüè´" },
            { en: "Has anyone ever asked you for your opinion?", vi: "ƒê√£ bao gi·ªù c√≥ ai h·ªèi √Ω ki·∫øn c·ªßa b·∫°n ch∆∞a?", emoji: "ü§î" },
            { en: "\"Pokemon\" is a famous Japanese cartoon in the world.", vi: "\"Pokemon\" l√† m·ªôt b·ªô phim ho·∫°t h√¨nh n·ªïi ti·∫øng c·ªßa Nh·∫≠t B·∫£n tr√™n th·∫ø gi·ªõi.", emoji: "üáØüáµ" },
            { en: "She often has breakfast with her family.", vi: "C√¥ ·∫•y th∆∞·ªùng ƒÉn s√°ng c√πng gia ƒë√¨nh.", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { en: "Her dream is to become a teacher.", vi: "∆Ø·ªõc m∆° c·ªßa c√¥ l√† tr·ªü th√†nh m·ªôt gi√°o vi√™n.", emoji: "üë©‚Äçüè´" },
            { en: "How many bars of soap would they like?", vi: "H·ªç mu·ªën bao nhi√™u thanh x√† ph√≤ng?", emoji: "üßº" },
            { en: "How does Mrs White travel to work?", vi: "B√† White ƒëi l√†m b·∫±ng ph∆∞∆°ng ti·ªán g√¨?", emoji: "üöå" },
            { en: "She reads in the library from 7 o'clock to 9.30.", vi: "C√¥ ·∫•y ƒë·ªçc s√°ch trong th∆∞ vi·ªán t·ª´ 7 gi·ªù ƒë·∫øn 9 gi·ªù 30.", emoji: "üìö" },
            { en: "\"Reduce\" means using something less.", vi: "\"Gi·∫£m\" c√≥ nghƒ©a l√† s·ª≠ d·ª•ng m·ªôt c√°i g√¨ ƒë√≥ √≠t h∆°n.", emoji: "‚ûñ" },
            { en: "Kyle often listens to music in his free time.", vi: "Kyle th∆∞·ªùng nghe nh·∫°c v√†o th·ªùi gian r·∫£nh.", emoji: "üéß" },
            { en: "Team sports require two separate teams.", vi: "C√°c m√¥n th·ªÉ thao ƒë·ªìng ƒë·ªôi y√™u c·∫ßu hai ƒë·ªôi ri√™ng bi·ªát.", emoji: "üßë‚Äçü§ù‚Äçüßë" },
            { en: "What is the weather like in winter?", vi: "Th·ªùi ti·∫øt v√†o m√πa ƒë√¥ng nh∆∞ th·∫ø n√†o?", emoji: "‚ùÑÔ∏è" },
            { en: "Recycling means creating new products from used materials.", vi: "T√°i ch·∫ø c√≥ nghƒ©a l√† t·∫°o ra c√°c s·∫£n ph·∫©m m·ªõi t·ª´ c√°c v·∫≠t li·ªáu ƒë√£ qua s·ª≠ d·ª•ng.", emoji: "‚ôªÔ∏è" },
            { en: "He sometimes plays badminton in the morning.", vi: "Anh ·∫•y th·ªânh tho·∫£ng ch∆°i c·∫ßu l√¥ng v√†o bu·ªïi s√°ng.", emoji: "üè∏" },
            { en: "My father and I will repaint our house before Tet.", vi: "B·ªë v√† t√¥i s·∫Ω s∆°n l·∫°i nh√† tr∆∞·ªõc T·∫øt.", emoji: "üé®" },
            { en: "He said 'Good morning' in a most friendly way.", vi: "Anh ·∫•y n√≥i 'Ch√†o bu·ªïi s√°ng' m·ªôt c√°ch th√¢n thi·ªán nh·∫•t.", emoji: "üëã" },
            { en: "Oxford University is the oldest university in Great Britain.", vi: "ƒê·∫°i h·ªçc Oxford l√† tr∆∞·ªùng ƒë·∫°i h·ªçc l√¢u ƒë·ªùi nh·∫•t ·ªü V∆∞∆°ng qu·ªëc Anh.", emoji: "üá¨üáß" },
            { en: "It was built in the 12th century.", vi: "N√≥ ƒë∆∞·ª£c x√¢y d·ª±ng v√†o th·∫ø k·ª∑ 12.", emoji: "üè∞" },
            { en: "Is this bed suitable for your bedroom?", vi: "Chi·∫øc gi∆∞·ªùng n√†y c√≥ ph√π h·ª£p v·ªõi ph√≤ng ng·ªß c·ªßa b·∫°n kh√¥ng?", emoji: "üõå" },
            { en: "Would you like to see a movie?", vi: "B·∫°n c√≥ mu·ªën xem phim kh√¥ng?", emoji: "üé¨" },
            { en: "We don't have much time now. We will see you later.", vi: "B√¢y gi·ªù ch√∫ng ta kh√¥ng c√≥ nhi·ªÅu th·ªùi gian. Ch√∫ng t√¥i s·∫Ω g·∫∑p l·∫°i b·∫°n sau.", emoji: "üëã" },
            { en: "Whose birthday party was it?", vi: "ƒê√≥ l√† b·ªØa ti·ªác sinh nh·∫≠t c·ªßa ai?", emoji: "üéÇ" }
        ];

        function createTopics(sentences, chunkSize) {
            const shuffled = [...sentences].sort(() => Math.random() - 0.5);
            const topics = {};
            let topicIndex = 1;
            for (let i = 0; i < shuffled.length; i += chunkSize) {
                const chunk = shuffled.slice(i, i + chunkSize);
                topics[`Ch·ªß ƒë·ªÅ ${topicIndex}`] = chunk;
                topicIndex++;
            }
            return topics;
        }

        const topics = createTopics(allSentences, 50);
        
        const GameState = {
            START: 'start',
            TOPIC_SELECTION: 'topicSelection',
            GAME: 'game',
            CONGRATS: 'congrats',
            REVIEW_ERRORS: 'review',
        };

        function useSpeechSynthesis() {
            const [isSpeaking, setIsSpeaking] = useState(false);
            const synth = window.speechSynthesis;

            const speak = useCallback((text, options = {}) => {
                if (!synth) return;

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = options.rate || 0.9;
                utterance.onstart = () => setIsSpeaking(true);
                utterance.onend = () => {
                    setIsSpeaking(false);
                    if (options.onEnd) options.onEnd();
                };
                utterance.onerror = () => {
                     setIsSpeaking(false);
                };

                if (synth.speaking) {
                    synth.cancel();
                }

                setTimeout(() => synth.speak(utterance), 100);

            }, [synth]);

            const cancel = useCallback(() => {
                if (synth) {
                    synth.cancel();
                    setIsSpeaking(false);
                }
            }, [synth]);

            useEffect(() => {
                return () => cancel();
            }, [cancel]);

            return { isSpeaking, speak, cancel };
        }

        function Fireworks() {
            const canvasRef = useRef(null);
            const animationFrameId = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let width = canvas.width = window.innerWidth;
                let height = canvas.height = window.innerHeight;
                let fireworks = [];
                let particles = [];
                let hue = 120;

                function random(min, max) { return Math.random() * (max - min) + min; }

                function Firework(sx, sy, tx, ty) {
                    this.x = sx; this.y = sy; this.sx = sx; this.sy = sy;
                    this.tx = tx; this.ty = ty;
                    this.distanceToTarget = Math.sqrt(Math.pow(tx - sx, 2) + Math.pow(ty - sy, 2));
                    this.distanceTraveled = 0;
                    this.coordinates = [];
                    this.coordinateCount = 3;
                    while (this.coordinateCount--) {
                        this.coordinates.push([this.x, this.y]);
                    }
                    this.angle = Math.atan2(ty - sy, tx - sx);
                    this.speed = 2;
                    this.acceleration = 1.05;
                    this.brightness = random(50, 70);
                    this.targetRadius = 1;
                }

                Firework.prototype.update = function (index) {
                    this.coordinates.pop();
                    this.coordinates.unshift([this.x, this.y]);
                    this.speed *= this.acceleration;
                    const vx = Math.cos(this.angle) * this.speed;
                    const vy = Math.sin(this.angle) * this.speed;
                    this.distanceTraveled = Math.sqrt(Math.pow(this.x + vx - this.sx, 2) + Math.pow(this.y + vy - this.sy, 2));
                    if (this.distanceTraveled >= this.distanceToTarget) {
                        fireworks.splice(index, 1);
                        for (let i = 0; i < 30; i++) {
                            particles.push(new Particle(this.tx, this.ty));
                        }
                    } else {
                        this.x += vx;
                        this.y += vy;
                    }
                };

                Firework.prototype.draw = function () {
                    ctx.beginPath();
                    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                    ctx.lineTo(this.x, this.y);
                    ctx.strokeStyle = `hsl(${hue}, 100%, ${this.brightness}%)`;
                    ctx.stroke();
                };

                function Particle(x, y) {
                    this.x = x; this.y = y;
                    this.coordinates = [];
                    this.coordinateCount = 5;
                    while (this.coordinateCount--) {
                        this.coordinates.push([this.x, this.y]);
                    }
                    this.angle = random(0, Math.PI * 2);
                    this.speed = random(1, 10);
                    this.friction = 0.95;
                    this.gravity = 1;
                    this.hue = random(hue - 20, hue + 20);
                    this.brightness = random(50, 80);
                    this.alpha = 1;
                    this.decay = random(0.015, 0.03);
                }

                Particle.prototype.update = function (index) {
                    this.coordinates.pop();
                    this.coordinates.unshift([this.x, this.y]);
                    this.speed *= this.friction;
                    this.x += Math.cos(this.angle) * this.speed;
                    this.y += Math.sin(this.angle) * this.speed + this.gravity;
                    this.alpha -= this.decay;
                    if (this.alpha <= this.decay) {
                        particles.splice(index, 1);
                    }
                };

                Particle.prototype.draw = function () {
                    ctx.beginPath();
                    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                    ctx.lineTo(this.x, this.y);
                    ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
                    ctx.stroke();
                };

                function loop() {
                    animationFrameId.current = requestAnimationFrame(loop);
                    hue += 0.5;
                    ctx.globalCompositeOperation = 'destination-out';
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, width, height);
                    ctx.globalCompositeOperation = 'lighter';
                    if (Math.random() < 0.05) {
                        fireworks.push(new Firework(width / 2, height, random(0, width), random(0, height / 2)));
                    }
                    fireworks.forEach((f, i) => { f.update(i); f.draw(); });
                    particles.forEach((p, i) => { p.update(i); p.draw(); });
                }

                const handleResize = () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                };

                window.addEventListener('resize', handleResize);
                loop();

                return () => {
                    cancelAnimationFrame(animationFrameId.current);
                    window.removeEventListener('resize', handleResize);
                };
            }, []);

            return <canvas ref={canvasRef}></canvas>;
        }

        function StartScreen({ onStart }) {
            const [playerName, setPlayerName] = useState('');
            const [error, setError] = useState('');

            const handleStart = () => {
                if (playerName.trim()) {
                    onStart(playerName.trim());
                } else {
                    setError('Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!');
                    setTimeout(() => setError(''), 3000);
                }
            };

            return (
                <div className="start-screen">
                    <input
                        type="text"
                        id="playerNameInput"
                        className="text-input"
                        placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..."
                        value={playerName}
                        onChange={(e) => setPlayerName(e.target.value)}
                        onKeyDown={(e) => e.key === 'Enter' && handleStart()}
                    />
                    <button id="startBtn" className="main-btn" onClick={handleStart}>B·∫Øt ƒë·∫ßu</button>
                    {error && <div className="message">{error}</div>}
                </div>
            );
        }

        function TopicSelectionScreen({ onSelectTopic }) {
            return (
                <div className="topic-selection-screen">
                    <div className="game-subtitle">Ch·ªçn m·ªôt ch·ªß ƒë·ªÅ ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
                    <div className="topic-btn-container">
                        {Object.keys(topics).map((topic, index) => (
                            <button
                                key={topic}
                                className={`topic-btn topic-btn-color-${(index % 6) + 1}`}
                                onClick={() => onSelectTopic(topic)}
                            >
                                {`${topic} (${topics[topic].length} c√¢u)`}
                            </button>
                        ))}
                    </div>
                </div>
            );
        }
        
        function ReviewErrorsScreen({ errors, onSelectTopic }) {
             const renderDiff = (correct, user) => {
                const diff = [];
                const cleanCorrect = correct.replace(/‚Äô/g, "'");
                const cleanUser = user.replace(/‚Äô/g, "'");
                const maxLength = Math.max(cleanCorrect.length, cleanUser.length);

                for (let i = 0; i < maxLength; i++) {
                    if (cleanCorrect[i] !== cleanUser[i]) {
                        diff.push(<span key={i} className="error-char">{cleanUser[i] || ''}</span>);
                    } else {
                        diff.push(<span key={i}>{cleanUser[i]}</span>);
                    }
                }
                return diff;
            };

            return (
                <div className="review-errors-screen">
                     <div className="game-subtitle">Xem l·∫°i c√°c c√¢u tr·∫£ l·ªùi sai</div>
                     <ul className="error-review-list">
                        {errors.map((error, index) => (
                            <li key={index} className="error-review-item">
                                <div className="error-label">ƒê√°p √°n ƒë√∫ng:</div>
                                <p className="correct-answer">{error.correctAnswer}</p>
                                <div className="error-label">C√¢u tr·∫£ l·ªùi c·ªßa b·∫°n:</div>
                                <p className="user-answer">{renderDiff(error.correctAnswer, error.userAnswer)}</p>
                            </li>
                        ))}
                     </ul>
                     <button className="congrats-btn" style={{backgroundColor: 'var(--primary-color)'}} onClick={onSelectTopic}>
                        Ch·ªçn ch·ªß ƒë·ªÅ kh√°c
                     </button>
                </div>
            );
        }

        function CongratsScreen({ score, total, correctCount, playerName, topic, onPlayAgain, onSelectTopic, onReviewErrors, errors }) {
            return (
                <div className="topic-congrats-screen">
                    <div className="message" style={{ color: 'var(--success-color)', fontSize: '1.5em', lineHeight: '1.4' }}>
                        Ch√∫c m·ª´ng <strong>{playerName}</strong>!<br />
                        B·∫°n ƒë√£ ƒë·∫°t {score} ƒëi·ªÉm, ho√†n th√†nh ƒë√∫ng {correctCount}/{total} c√¢u trong "{topic}".
                    </div>
                    {errors.length > 0 && (
                         <button className="congrats-btn" style={{backgroundColor: 'var(--yellow-color)', color: 'var(--text-color)'}} onClick={onReviewErrors}>
                            Xem l·∫°i l·ªói sai ({errors.length})
                         </button>
                    )}
                    <button className="congrats-btn" style={{backgroundColor: 'var(--success-color)'}} onClick={onPlayAgain}>Ch∆°i l·∫°i ch·ªß ƒë·ªÅ n√†y</button>
                    <button className="congrats-btn" style={{backgroundColor: 'var(--primary-dark)'}} onClick={onSelectTopic}>Ch·ªçn ch·ªß ƒë·ªÅ kh√°c</button>
                    <Fireworks />
                </div>
            );
        }

        function GameScreen({ sentences, onGameEnd, onBackToTopics, topicName }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [completed, setCompleted] = useState(0);
            const [correctCount, setCorrectCount] = useState(0);
            const [mistakeCount, setMistakeCount] = useState(0);
            const [userAnswer, setUserAnswer] = useState('');
            const [message, setMessage] = useState('');
            const [messageColor, setMessageColor] = useState('var(--error-color)');
            const [isCorrect, setIsCorrect] = useState(null);
            const [isLocked, setIsLocked] = useState(false);
            const [errors, setErrors] = useState([]);
            
            const { isSpeaking, speak, cancel } = useSpeechSynthesis();
            const inputRef = useRef(null);
            const nextSentenceTimeoutRef = useRef(null);

            const currentSentence = sentences[currentIndex];

            const startNewSentence = useCallback((index) => {
                cancel();
                if (nextSentenceTimeoutRef.current) clearTimeout(nextSentenceTimeoutRef.current);

                if (index >= sentences.length) {
                    onGameEnd({ score, completed, correctCount, errors });
                    return;
                }
                
                setCurrentIndex(index);
                setUserAnswer('');
                setMistakeCount(0);
                setMessage('');
                setIsCorrect(null);
                setIsLocked(false);
                inputRef.current?.focus();
                
                const sentenceToSpeak = sentences[index].en;
                speak(sentenceToSpeak, { onEnd: () => {
                    if (!isSpeaking) {
                         speak(sentenceToSpeak);
                    }
                }});

            }, [sentences, onGameEnd, score, completed, correctCount, errors, cancel, speak, isSpeaking]);
            
            useEffect(() => {
                startNewSentence(0);
                return () => {
                    cancel();
                    if (nextSentenceTimeoutRef.current) clearTimeout(nextSentenceTimeoutRef.current);
                };
            }, [sentences]);

            const normalizeAnswer = (str) => {
                return str
                    .trim()
                    .replace(/‚Äô/g, "'") // Normalize apostrophes
                    .replace(/‚Äú|‚Äù/g, '"'); // Normalize quotation marks
            };

            const handleCheckAnswer = () => {
                if (isLocked) return;
                
                const cleanedUserAnswer = normalizeAnswer(userAnswer);
                const correctAnswer = normalizeAnswer(currentSentence.en);

                if (cleanedUserAnswer === correctAnswer) {
                    setIsCorrect(true);
                    setIsLocked(true);
                    setMessage('Ch√≠nh x√°c! +10 ƒëi·ªÉm.');
                    setMessageColor('var(--success-color)');
                    setScore(prev => prev + 10);
                    setCorrectCount(prev => prev + 1);
                    setCompleted(prev => prev + 1);
                    cancel();
                    speak(correctAnswer, { onEnd: () => {
                        nextSentenceTimeoutRef.current = setTimeout(() => startNewSentence(currentIndex + 1), 2000);
                    }});
                } else {
                    const newMistakeCount = mistakeCount + 1;
                    setMistakeCount(newMistakeCount);
                    setIsCorrect(false);
                    
                    if (newMistakeCount >= 3) {
                        setIsLocked(true);
                        setMessage(`B·∫°n ƒë√£ sai 3 l·∫ßn. ƒê√°p √°n: "${currentSentence.en}"`);
                        setErrors(prev => [...prev, { correctAnswer: currentSentence.en, userAnswer: userAnswer.trim() }]);
                        setCompleted(prev => prev + 1);
                        cancel();
                        nextSentenceTimeoutRef.current = setTimeout(() => startNewSentence(currentIndex + 1), 3500);
                    } else {
                        setMessage(`Sai r·ªìi! (S·ªë l·∫ßn sai: ${newMistakeCount}/3)`);
                        setTimeout(() => setIsCorrect(null), 500);
                    }
                }
            };
            
            const handleListenAgain = () => {
                if (!isSpeaking) {
                    speak(currentSentence.en);
                }
            };

            const hintRef = useRef(null);

            const showHint = () => {
                if(hintRef.current) hintRef.current.style.display = 'block';
            };
            const hideHint = () => {
                if(hintRef.current) hintRef.current.style.display = 'none';
            };


            if (!currentSentence) return <div>ƒêang t·∫£i...</div>;

            return (
                <div className="game-screen">
                    <div className="game-subtitle">Ch·ªß ƒë·ªÅ: {topicName}</div>
                    <div className="meaning">
                        <span>&ldquo;{currentSentence.vi}&rdquo;</span>
                        <span>{currentSentence.emoji}</span>
                    </div>
                    <div className="input-container">
                        <input
                            ref={inputRef}
                            type="text"
                            id="answerInput"
                            placeholder="Nh·∫≠p c√¢u b·∫°n nghe ƒë∆∞·ª£c..."
                            autoComplete="off"
                            autoCorrect="off"
                            autoCapitalize="off"
                            spellCheck="false"
                            value={userAnswer}
                            onChange={(e) => setUserAnswer(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCheckAnswer()}
                            disabled={isLocked}
                            className={`${isCorrect === true ? 'correct' : ''} ${isCorrect === false ? 'incorrect' : ''}`}
                        />
                        <div id="hint" ref={hintRef}>{currentSentence.en}</div>
                    </div>
                    <div className="message" style={{ color: messageColor }}>{message}</div>
                    <div className="buttons">
                        <button id="listenAgainBtn" onClick={handleListenAgain} disabled={isSpeaking || isLocked}>Nghe l·∫°i</button>
                        <button id="checkBtn" onClick={handleCheckAnswer} disabled={isLocked}>Ki·ªÉm tra</button>
                         <button 
                            id="hintBtn" 
                            disabled={isLocked}
                            onMouseDown={showHint}
                            onMouseUp={hideHint}
                            onMouseLeave={hideHint}
                            onTouchStart={(e) => { e.preventDefault(); showHint(); }}
                            onTouchEnd={hideHint}
                            style={{backgroundColor: 'var(--yellow-color)', color: 'var(--text-color)'}}
                        >
                            G·ª£i √Ω
                        </button>
                        <button id="resetBtn" onClick={onBackToTopics} style={{backgroundColor: '#757575'}}>Ch·ªß ƒë·ªÅ kh√°c</button>
                    </div>
                    <div className="score">ƒêi·ªÉm: {score} | Ho√†n th√†nh: {completed}/{sentences.length}</div>
                </div>
            );
        }

        function App() {
            const [gameState, setGameState] = useState(GameState.START);
            const [playerName, setPlayerName] = useState('');
            const [currentTopic, setCurrentTopic] = useState(null);
            const [gameResult, setGameResult] = useState({ score: 0, total: 0, correctCount: 0, errors: [] });
            
            const { cancel: cancelSpeech } = useSpeechSynthesis();

            const handleStart = (name) => {
                setPlayerName(name);
                setGameState(GameState.TOPIC_SELECTION);
            };

            const handleSelectTopic = (topic) => {
                setCurrentTopic(topic);
                setGameState(GameState.GAME);
            };
            
            const handleBackToTopics = () => {
                cancelSpeech();
                setGameState(GameState.TOPIC_SELECTION);
            };

            const handleGameEnd = (result) => {
                setGameResult({
                     score: result.score, 
                     total: topics[currentTopic].length,
                     correctCount: result.correctCount,
                     errors: result.errors
                });
                setGameState(GameState.CONGRATS);
            };
            
            const handlePlayAgain = () => {
                setGameState(GameState.GAME);
            };
            
            const handleReviewErrors = () => {
                setGameState(GameState.REVIEW_ERRORS);
            };

            const renderScreen = () => {
                switch (gameState) {
                    case GameState.START:
                        return <StartScreen onStart={handleStart} />;
                    case GameState.TOPIC_SELECTION:
                        return <TopicSelectionScreen onSelectTopic={handleSelectTopic} />;
                    case GameState.GAME:
                        return <GameScreen 
                                    sentences={topics[currentTopic]}
                                    topicName={currentTopic} 
                                    onGameEnd={handleGameEnd} 
                                    onBackToTopics={handleBackToTopics} 
                                />;
                    case GameState.CONGRATS:
                        return <CongratsScreen 
                                    {...gameResult} 
                                    playerName={playerName} 
                                    topic={currentTopic}
                                    onPlayAgain={handlePlayAgain}
                                    onSelectTopic={handleBackToTopics}
                                    onReviewErrors={handleReviewErrors}
                                />;
                    case GameState.REVIEW_ERRORS:
                        return <ReviewErrorsScreen 
                                    errors={gameResult.errors} 
                                    onSelectTopic={handleBackToTopics}
                               />
                    default:
                        return <StartScreen onStart={handleStart} />;
                }
            };

            return (
                <div className="container">
                    <div className="game-title">NGHE V√Ä VI·∫æT CH√çNH T·∫¢</div>
                    {renderScreen()}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>
